\chapter{Производящие функции}
\section{Производящие функции и их основные свойства}

\begin{utv}
    Пусть имеется последовательность чисел $a_1, a_2, ..., a_n, ...$
    Тогда ее производящей функцией называется степенной ряд
    \begin{equation}
        A(x) = \sum_{n=0}^{\infty} a_nx^n
    \end{equation}
\end{utv}

Требуем, чтобы данный ряд сходился хотя бы при малых $x$.

Рассмотрим свойства производящих функций и некоторые их доказательства.


\begin{enumerate}
    \item \textbf{Линейность.}
    Пусть $c_n = pa_n + qb_n$, $p, q = const$ Тогда 
    \begin{equation}
        \label{linear_p}
        C(x) = pA(x) + qB(x)
    \end{equation}
    \textbf{Доказательство}
    \begin{equation*}
        pA(x) + qB(x) = \sum_{n = 0}^{\infty} (pa_n + qb_n)x^n = \\
        \sum_{n=0}^{\infty} c_n x^n = C(x)
    \end{equation*}

    \item \textbf{Сдвиг вправо.}
    Сдвиг начала последовательности вправо на i позиций.
    Пусть $b_n = a_{n-i}, n \geq i$,  $b_n = 0, 0 \leq n \leq i-1$, тогда
    \begin{equation}
        \label{bias_right_p}
        B(x) = x^iA(x)
    \end{equation}
    \textbf{Доказательство}
    \begin{equation*}
        B(x) = \sum_{n = 0}^{\infty} b_n x^n = \sum_{n = i}^{\infty} a_{n-i}x^n = \\
        x^i \sum_{n = i}^{\infty} a_{n-i} x^{n-i} = x^{-i}\sum_{k = 0}^{\infty} a_k x^k = x^i A(x)
    \end{equation*}
    
    \item \textbf{Сдвиг влево.}
    Сдвиг начала последовательности влево на i позиций. Пусть последовательность чисел
    $b_n$ и $a_n$ связаны: $b_n = a_{n+i}$ Тогда
    \begin{equation}
        \label{bias_left_p}
        B(x) = x^{-i}(A(x) - \sum_{k = 0 }^{i - 1} a_k x^k)
    \end{equation}
    \textbf{Доказательство}
    \begin{multline*}
        B(x) = \sum_{n = 0}^{\infty} b_n x^n = \sum_{n = 0}^{\infty} a_{n+i} x^n =
        x^{-i} \sum_{n = 0}^{\infty} a_{n+i}x^{n+i} = \\
        x^{-i}(\sum_{k = 0}^{\infty} a_k x^k - 
        \sum_{k = 0}^{i-1} a_k x^k) = x^{-i}(A(x) - \sum_{k = 0}^{i-1} a_k x^k)    
    \end{multline*}

    \item \textbf{Частичная сумма.}
    Пусть $b_n = \sum_{k = 0}^{n} a_k$. Тогда
    \begin{equation}
        \label{partial_sum_p}
        B(x) = \frac{A(x)}{1-x}
    \end{equation}
    \textbf{Доказательство}
    Функция $\frac{1}{1-k}$ при $|x| < 1$ в ряд Маклорена
    \begin{equation*}
        \frac{1}{1 - x} = \sum_{k = 0}^{\infty} x^k
    \end{equation*}
    Поэтому в некоторой окрестности $x = 0$
    \begin{equation*}
        \frac{A(x)}{1-x} = \sum_{k = 0}^{\infty} a_k x^k \sum_{k = 0}^{\infty} x^k =
        \sum_{n = 0}^{\infty} x^n \sum_{k = 0}^{\infty} a_k = \sum_{n = 0}^{\infty} b_n x^n = B(x)
    \end{equation*}

    \item \textbf{Дополнительная частичная сумма.}
    Пусть $b_n = \sum_{k = n}^{\infty} a_k$. Тогда
    \begin{equation}
        \label{ext_partial_sum_p}
        B(x) = \frac{A(1) - xA(x)}{1-x}
    \end{equation}

    \item \textbf{1 тип изменения масштаба.}
    Пусть $b_n = na_n$. Тогда
    \begin{equation}
        \label{1_change_scale_p}
        B(x) = xA'(x)
    \end{equation}

    \item \textbf{2 тип изменения масштаба.}
    Пусть $b_n = \frac{a_n}{n + 1}$. Тогда
    \begin{equation}
        \label{2_change_scale_p}
        B(x) = \frac{1}{x}\int_0^x A(x)dx
    \end{equation}
    
    \item \textbf{Свертка.}
    Пусть $C_n = \sum_{k = 0}^{n} a_k b_{n - k}$ Тогда 
    \begin{equation}
        \label{conv_p}
        C(x) = A(x)B(x)
    \end{equation}
\end{enumerate}

\section{Задачи}
\begin{task}
    $\frac{1}{1 - x} = \sum_{n = 0}^{\infty} x^n, |x| < 1$. 
    Для последовательности $a_n = 1$ будет $A(x) = \frac{1}{1 - x}$.
\end{task}

\begin{task}
    $\frac{1}{x} \ln{\frac{1}{1 - x}} = \sum_{n = 0}^\infty \frac{x^n}{n + 1}, |x| < 1$
    Следовательно, производящей функцией для последовательности $a_n = \frac{1}{n + 1}$ будет
    $A(x) = \frac{1}{n}\ln{\frac{1}{1 - x}}$
\end{task}

\begin{task}
    Дана последовательность $a_n = q^n$. Найти ее производящую функцию.
    \begin{solution}
        \begin{equation*}
            A(x) = \sum_{n = 0}^{\infty} q^n x^n = \sum_{n = 0}^{\infty} = (qx)^n = \frac{1}{1 - qx}
        \end{equation*}
    \end{solution}
\end{task}

\begin{task}
    Дана последовательность $a_n = n$. Найти ее производящую функцию.
    \begin{solution}
        Запишем новую последовательность $b_n = 1$ и выразим $a_n$ через нее: $a_n = n b_n$.
        Теперь можно воспользоваться свойством \ref{1_change_scale_p}:
        \begin{gather*}
            B(x) = \frac{1}{1-x} \\
            A(x) = xB'(x) = \frac{x}{(1-x)^2}
        \end{gather*}
    \end{solution}
\end{task}

\begin{task}
    Дана последовательность $b_n = n^2$. Найти ее производящую функцию.
    \begin{solution}
        Как и в прошлом примере введем новую последовательность $a_n = n$ и выразим через нее
        $b_n$: $b_n = na_n$. Cнова дважды вспомним \ref{1_change_scale_p} используя результат
        предыдущей задачи:
        \begin{gather*}
            B(x) = xA'(x) \\
            A(x) = \frac{x}{(1 - x)^2} \\
            B(x) = \frac{x + x^2}{(1 - x)^3}
        \end{gather*}
    \end{solution}
\end{task}

\begin{task}
    Дана последовательность $a_n = n(2^n + (-1)^n n), n \geq 0$. Найти ее
    производящую функцию.
    \begin{solution}
        Сперва раскроем скобки: 
        \begin{equation*}
            a_n = 2^n n + (-1)^n n^2
        \end{equation*}
        Теперь разделим изначальную последовательность на 2 части:
        Первая часть будет $b_n = 2^n n$, а вторая $c_n = (-1)^n n^2$. \\
        Тогда производящая функция $a_n$ будет равна $A(x) = B(x) + C(x)$.
        Найдем теперь производящие функции у каждой части: \\
        1. Введем новую последовательность $k_n = 2^n$ и выразим $b_n = k_n n$.
        Используя свойства \ref{partial_sum_p} и \ref{1_change_scale_p} найдем $B(x)$ используя $K(x)$:
        \begin{gather*}
            K(x) = \sum_{n = 0}^{\infty} 2^n x^n = \frac{1}{1 - 2x} \\
            B(x) = xK'(x) = x (\frac{1}{1 - 2x})'_x = \frac{2x}{(1 - 2x)^2}
        \end{gather*}
        2. Для второй части тоже следует ввести новые последовательности:
        $d_n = (-1)^n$ и $m_n = (-1)^n n = d_n n$. Выразим теперь
        $c_n = m_n n$. Будем использовать те же свойства, только больше ;)
        \begin{gather*}
            D(x) = \sum_{n = 0}^{\infty}(-1)^n x^n = \frac{1}{1 + x} \\
            M(x) = x D'(x) = x (\frac{1}{1 + x})'_x = \frac{-x}{(1 + x)^2} \\
            C(x) = x M'(x) = x (\frac{-x}{(1 + x)^2})'_x = \frac{x(x - 1)}{(1 + x)^3}
        \end{gather*}
        Теперь вычислим $A(x)$:
        \begin{equation*}
            A(x) = B(x) + C(x) = \frac{2x}{(1 - 2x)^2} + \frac{x^2 - x}{(1 + x)^3}
        \end{equation*}
    \end{solution}
\end{task}

\section{Линейные рекуррентные соотношения}
\begin{utv}
    Линейным рекуррентным соотношением относительно последовательности $a_n$ называется
    соотношение вида 
    \begin{equation}
        a_{n+k} = c_1 a_{n+k-1} + c_2 a_{n+k-2} + ... + c_k a_n + d_n
    \end{equation}
    где $k$ - заданное натуральное число, $n = 1, 2, 3, ...$. 
\end{utv}
При этом должны быть заданы начальные значения $a_0, a_1, ..., a_{k-1}$, 
а также коэффициенты $c_1, c_2, ..., c_k$ и последовательность $d_n$. Решением 
этого соотношения называется аналитическая формула для $a_n$, удовлетворяющая ему, 
а так же заданным начальным значениям.

\vspace{5mm}

Линейное рекуррентное соотношение называется \textbf{однородным}, если числа $d_n = 0$. В 
противном случае оно называется \textbf{неоднородным}.

\vspace{5mm}

\textbf{Задача Фибоначчи и рекуррентное соотношение для нее}.
 
Первой известной задачей, приведшей к рекуррентному соотношению,
является задача Фибоначчи о кроликах. Ставится она следующим
образом. Пусть в начальный момент была одна пара только что
родившихся кроликов. Предполагается, что такая пара достигнет зрелости
через месяц и еще через месяц она даст потомство в виде новой пары
разнополых кроликов. Задача состоит в определении числа пар кроликов
по прошествии $n$ месяцев.

Пусть в $n$-ый месяц имеется $M$ молодых пар и $N$ зрелых пар кроликов. 
Тогда в $n+1$-ый месяц будет $N$ молодых пар и $M + N$ зрелых пар, а в $n+2$-ой
месяц будет $M + N$ молодых пар и $M + 2N$ зрелых пар. Таким образом, общее число
пар кроликов в $n$-ый месяц равно $M + N$ , в $n+1$-ый месяц равно $M + 2N$
а в $n+2$-ой месяц равно $2M + 3N$. Обозначим число пар кроликов в $n$-ый месяц 
через $n_a$. Тогда приходим к следующему выводу:
\begin{equation}
    a_{n+2} = a_{n+1} + a_n
\end{equation}

Это и есть \textbf{рекуррентное соотношение для задачи Фибоначчи}. Начальным условиями для него
будут следующие: $a_0 = a_1 = 1$.

\section{Метод решения линейные рекуррентых соотношений с помощью производящих функций}
Рассмотрим рекуррентное соотношение
\begin{equation*}
    a_{n+k} = c_1 a_{n+k-1} + c_2 a_{n+k-2} + ... + c_k a_n + d_n, n \geq 0
\end{equation*}
с заданными начальными условиями $a_0, a_1, ..., a_{k-1}$.

Введем для неизвестной последовательности $a_n$ производящую функцию $A(x)$, а для заданной
последовательности $d_n$ - производящую функцию $D(x)$. Определим теперь производящие функции для
левой и правой частей рассматриваемого рекуррентного соотношения, используя свойства \ref{linear_p} и \ref{bias_left_p} производящей
функции.

Тогда для левой части получим производящую функцию 
\begin{equation*}
    x^{-k}\left(A(x) - \sum_{i = 0}^{k-1} a_i x^i\right)
\end{equation*}

Для правой же части рекуррентного соотношения производящая функция имеет вид:
\begin{multline*}
    c_1 x^{-k+1}\left(A(x) - \sum_{i = 0}^{k-2} a_i x^i\right) + c_2 x^{-k+2}\left(A(x) - \sum_{i = 0}^{k-3} a_i x^i \right) + \\
    + c_{k-1}x^{-1}(A(x) - a_0) + c_k A(x) + D(x)
\end{multline*}

Приравнивая эти две производящие функции и умножая их на $x_k$, получим
\begin{eqnarray*}
    A(x)(1 - c_1x - c_2 x^2 - ... - c_k x^k) = \sum_{i = 0}^{k-1} a_i x^i - c_1 x \sum_{i = 0}^{k-3} a_i x^i - ... \\
    - c_{k-1}x^{k-1}a_0 + x^k D(x)
\end{eqnarray*}

Это равенство можно записать как
\begin{equation}
    \label{gen_func_rec}
    A(x) = \frac{P_{k-1}(x) + x^k D(x)}{1 - c_1 x - c_2 x^2 - ... - c_k x^k}
\end{equation}
где $P_{k-1}(x)$ - многочлен степени $\leq k - 1$, имеющий вид 
\begin{equation}
    \label{p_k}
    P_{k-1}(x) = \sum_{i = 0}^{k - 1}a_i x^i - c_1 x \sum_{i = 0}^{k-2}a_i x^i - c_2 x^2\sum_{i = 0}^{k-3} a_i x^i - ... \\
    c_{k-1} x^{k-1}a_0 
\end{equation}
Этот многочлен полностью определяется заданными начальными значениями $a_0, a_1, ..., a_{k-1}$.

Для решения рассматриваемого рекуррентного соотношения нужно сначала разложить многочлен 
$1 - c_1x - c_2x^2 - ... - c_k x^k$ на множители, определив его корни. Затем надо представить полученное
выше выражение для $A(x)$ в виде суммы простых дробей, используя метод неопределенных коэффициентов. Далее нужно разложить
эти простые дроби в ряд Маклорена.

Полученные в результате коэффициенты $a_n$ разложения $A(x)$ в ряд Маклорена и будут являться
искомым решением рекуррентного соотношения.

\section{Задачи}
Чтобы было проще решать подобные задачи, можно вывести определенный алгоритм:
\begin{enumerate}
    \item Определить $k, d_n, c_i$
    \item Если $d_n \neq 0$ вычислить $D(x)$
    \item Вычислить $P_{k-1}$ по \ref{p_k}
    \item Определить и разложить на простые дроби $A(x)$
    \item Найти коэффициенты
    \item Подставить в $A(x)$
    \item Исходя из того, что $A(x) = \sum_{n = 0}^{\infty} a_n x^n$ найти $a_n$
\end{enumerate}
\begin{task}
    Рассмотрим рекуррентное соотношение задачи Фибоначчи:
    \begin{equation*}
        a_{n+2} = a_{n+1} + a_n, a_0 = a_1 = 1
    \end{equation*}
    \begin{solution}
        Для него имеем:
        \begin{equation*}
            k = 2, d_n = 0, D(x) = 0, c_1 = c_2 = 1
        \end{equation*}
        Учитывая, что $k = 2$, используем \ref{p_k}, чтобы найти $P_1(x)$. Далее подставляем значения выше:
        \begin{equation*}
            P_1(x) = (a_0 + a_1 x) - c_1 x a_0 = 1
        \end{equation*}
        Используя \ref{gen_func_rec} находим:
        \begin{equation*}
            A(x) = \frac{1}{1 - x - x^2} = \frac{1}{(1 - \frac{x}{x_1})(1 - \frac{x}{x_2})}
        \end{equation*}
        где $x_1, x_2$ - корни квадратного уравнения трехчлена $1 - x - x^2$:
        \begin{gather*}
            x_1 = \frac{\sqrt{5} - 1}{2} \\
            x_2 = -\frac{\sqrt{5} - 1}{2}
        \end{gather*}
        Представим $A(x)$ в виде суммы простых дробей:
        \begin{equation*}
            A(x) = \frac{1}{(1 - \frac{x}{x_1})(1 - \frac{x}{x_2})} = \frac{C}{1 - \frac{x}{x_1}} + \frac{D}{1 - \frac{x}{x_2}}
        \end{equation*}
        Умножим это равенство на общий знаменатель. Тогда получим:
        \begin{equation*}
            1 = C(1 - \frac{x}{x_2}) + D(1 - \frac{x}{x_1})
        \end{equation*}
        Приравнивая коэффициенты слева и справа при $x^1$ и $x^0$, приходим к двум линейным уравнениям
        относительно $C$ и $D$:
        \begin{gather*}
            1 = C + D - x\left(\frac{C}{x_2} + \frac{D}{x_1}\right) \\
            0 = -\frac{C}{x_2} - \frac{D}{x_1} \\
            1 = C + D
        \end{gather*}
        Решая эти уравнения, находим
        \begin{equation*}
            C = -\frac{x_2}{x_1 - x_2}, D = \frac{x_1}{x_1 - x_2}
        \end{equation*}
        Разлагая $A(x)$ в ряд Маклорена, получаем
        \begin{equation*}
            A(x) = C\sum_{n = 0}^{\infty} \left(\frac{x}{x_1}\right)^n + D\sum_{n = 0}^{\infty}\left(\frac{x}{x_2}\right)^n = 
            \frac{1}{x_1 - x_2} \sum_{n = 0}^{\infty}\left(\frac{x_1}{x_2^n} - \frac{x_2}{x_1^n}\right)x^n
        \end{equation*}
        Легко проверить, что 
        \begin{gather*}
            x_1 - x_2 = \sqrt{5} \\
            \frac{1}{x_1} = -x_2 \\
            \frac{1}{x_1} = -x_11
        \end{gather*}
        Поэтому, учитывая определение производящей функции $A(x)$, находим
        \begin{equation*}
            A(x) = \sum_{n = 0}^{\infty} a_n x^n = \frac{1}{\sqrt{5}}\sum_{n = 0}^{\infty}\left((-x_2)^{n+1} - (-x_1)^{n+1}\right)x^n
        \end{equation*}
        Отсюда окончательно получаем:
        \begin{equation*}
            a_n = \frac{1}{\sqrt{5}}\left((-x_2)^{n+1} - (-x_1)^{n+1}\right) = 
            \frac{1}{\sqrt{5}}\left[{\left(\frac{1+\sqrt{5}}{2}\right)}^{n+1} - {\left(\frac{1-\sqrt{5}}{2}\right)}^{n+1}\right]
        \end{equation*}
    \end{solution}
\end{task}

\begin{task}
    \begin{equation*}
        a_{n+2} = 2a_{n+1} - a_n + 2^n n, a_0 = 3, a_1 = 1
    \end{equation*}
    \begin{solution}
        Здесь,
        \begin{equation*}
            k = 2, c_1 = 2, c_2 = -1, d_n = 2^n n
        \end{equation*}
        Сначала найдем производящую функцию $D(x)$ для $d_n$. 
        Производящая функция для последовательности $2^n$ равна $\frac{1}{1-2x}$. 
        Применяя свойство \ref{1_change_scale_p}, находим 
        \begin{equation*}
            D(x) = x \frac{d}{dx} \left(\frac{1}{1 - 2x}\right) = \frac{2x}{(1 - 2x)^2}
        \end{equation*}
        Определим теперь многолчен $P_{k-1}(x) = P_1(x)$, входящий в формулу для производящей функции
        $A(x)$ последовательности $a_n$, используя \ref{p_k}:
        \begin{equation*}
            P_1(x) = (a_0 + a_1x) - 2xa_0 = 3 - 5x
        \end{equation*}
        В результате, формула для $A(x)$ приобретает вид 
        \begin{equation*}
            A(x) = \frac{3 - 5x + \frac{2x^3}{(1-2x)^2}}{1 - 2x + x^2} = 
            \frac{(3 - 5x)(1 - 2x)^2 + 2x^3}{(1 - 2x)^2 (1 - x)^2}
        \end{equation*}
        Числитель последней дроби имеет корень 1 и, значит, делится на $1 - x$. Сокращая в этой дроби
        числитель и знаменатель на $1 - x$, находим
        \begin{equation*}
            A(x) = \frac{3 - 14x + 18x^2}{(1 - 2x)^2(1 - x)}
        \end{equation*}
        Разложим $A(x)$ на простые дроби:
        \begin{equation*}
            A(x) = \frac{3 - 14x + 18x^2}{(1 - 2x)^2 (1 - x)} = 
            \frac{C_1}{(1 - 2x)^2} + \frac{C_2}{1 - 2x} + \frac{C_3}{1 - x} 
        \end{equation*}
        где $C_i$ - постоянные. Умножая данное равенство на общий знаменатель, получаем
        \begin{equation*}
            3 - 14x + 18x^2 = C_1(1 - x) + C_2(1 - 2x)(1 - x) + C_3(1 - 2x)^2
        \end{equation*}
        Приравнивая коэффициенты при $x^2, x^1, x^0$, приходим к системе уравнений относительно
        $C_1, C_2, C_3$:
        \begin{gather*}
            18 = 2C_2 + 4C_3 \\
            -14 = -C_1 - 3C_2 - 4C_3 \\
            3 = C_1 + C_2 + C_3
        \end{gather*}
        Решая эту систему, находим
        \begin{equation*}
            C_1 = 1, C_2 = -5, C_3 = 7
        \end{equation*}
        Разлагая простые дроби в выражении для $A(x)$ в ряд Маклорена, используя \ref{ext_partial_sum_p},
        получаем
        \begin{equation*}
            A(x) = C_1 \sum_{n = 0}^{\infty} (n+1)(2x)^n + C_2 \sum_{n = 0}^{\infty} (2x)^n + C_3 \sum_{n = 0}^{\infty} x^n
        \end{equation*}
        Следовательно, находим
        \begin{equation*}
            A(x) = \sum_{n = 0}^{\infty} a_n x^n = \sum_{n = 0}^{\infty}\left[(n - 4) 2^n + 7\right] x^n
        \end{equation*}
    \end{solution}
\end{task}

\begin{task}
    Найти общее решение рекуррентного соотношения:
    \begin{equation*}
        u_{n+2} = u_{n+1} + u_n
    \end{equation*}
    \begin{solution}
        Будем искать решение в виде $u_n = q^n$:
        \begin{gather*}
            q^{n+2} = q^{n+1} + q^n \\
            q^2 - q - 1 = 0 \\
            q_{1, 2} = \frac{1 \pm \sqrt{5}}{2}
        \end{gather*}
        Таким образом, общее решение имеет вид:
        \begin{equation}
            u_{\text{общ}} = C_1 \left(\frac{1 + \sqrt{5}}{2}\right) ^ n + C_2\left(\frac{1 - \sqrt{5}}{2}\right) ^ n
        \end{equation}
    \end{solution}
\end{task}

\begin{task}
    Найти общее решение рекуррентного соотношения:
    \begin{equation*}
        a_{n+3} - 3a_{n+2} + 3a_{n+1} - a_n = 1 - 4^n
    \end{equation*}
    \begin{solution}
        Ищем однородное:
        \begin{gather*}
            a_n = q^n \\
            q^3 - 3q^2 + 3q - 1 = 0 \\
            (q - 1)^k = (q - 1)^3 = 0 \\
            q = 1
        \end{gather*}
        Кратность равна k = 3.
        Тогда,
        \begin{equation*}
            U_{\text{одн}} = P(k-1)q^n = (A + Bn + Cn^2)1^n
        \end{equation*}
        Теперь найдем правую часть для 1:
        \begin{gather*}
            d_n = 1 \cdot 1^n \\
            U_{\text{част 1}} = A n^3 1^n \\
            A(n+3)^3 - 3A(n+2)^3 + 3A(n+1)^3 - An^3 = 1 \\
            3^3A - 3A \cdot 2^3 + 3A = 1 \\
            A(27 - 24 + 3) = 1 \\
            6A = 1 \\
            A = \frac{1}{6} \\
            U_{\text{част 1}} = \frac{n^3}{6}
        \end{gather*}
        Далее для $4^n$:
        \begin{gather*}
            d_n = -4^n = (-1) 4^n \\
            U_{\text{част 2}} = A \cdot 4^n \\
            A \cdot 4^{n+3} - 3A \cdot 4^{n+2} + 3A \cdot 4^{n+1} - A \cdot 4^n = -4^n \\
            A \cdot 4^3 - 3A \cdot 4^2 + 12 A - A = -1 \\
            27A = -1 \\
            A = \frac{-1}{27} \\
            U_{\text{част 2}} = \frac{-4^n}{27}
        \end{gather*}
        Итог:
        \begin{gather*}
            U_{\text{общ}} = U_{\text{одн}} + U_{\text{част 1}} + U_{\text{част 2}} \\
            U_{\text{общ}} = A + Bn + Cn^2 + \frac{n^3}{6} - \frac{4^n}{27}
        \end{gather*}
    \end{solution}
\end{task}

\begin{task}
    Решить рекуррентное соотношение:
    \begin{gather*}
        a_{n+2} + a_{n+1} - 2a_n = (-2)^nn \\
        \text{если } n \geq 0, a_0=1, a_1=2
    \end{gather*}

    \begin{solution}
        Ищем решение для однородного характеристического уравнения.
        \begin{gather*}
            q^2+q-2=0 \\
            q_1 = -2 \\
            q_2 = 1
        \end{gather*}
        \begin{equation*}
            a_n = 1^n C_1 + (-2)^n C_2
        \end{equation*}
        Нахождение частичного решения:
        \begin{equation*}
            a_n = (-2)^n (C_3 + C_4)n
        \end{equation*}

        \begin{multline*}
            (-2)^{n+2}(C_3(n+2)+C_4)(n+2) + (-2)^{n+1}(C(n+1)+C_4)(n+1) - \\
            - 2 \cdot (-2)^n (C_3n + C_4)n = (-2)^nn 
        \end{multline*}
        \begin{gather*}
            4(C_3(n+2)+C_4)(n+2)-2(C_3(n+1)+C_4)(n+1)-2(C_3n+C_4)n = n \\
            12nC_3 + 14C_3 - n + 6C_4 = 0 \\
            n(12C_3 - 1) + 14C_3 - 6C_4 = 0 \\
            \begin{cases}
                12С_3 - 1 = 0 \\
                14С_3 + 6С_4=0 
            \end{cases} \\
            a_n = (-2)^n \left(\frac{n}{12} - \frac{7}{36}\right)n
        \end{gather*}
        \begin{gather*}
            a_n = a_n\text{част} + a_n\text{однор} \\
            a_n = C_1 + (-2)^nC_2 + (-2)^n\left(\frac{n}{12} - \frac{7}{36}\right)n \\
            \begin{cases}
                1 = C_1 + C_2 \\
                2 = C_1 - 2C_2 - 2\left(\frac{1}{12}-\frac{7}{36}\right)
            \end{cases} \\
            \begin{cases}
                C_1 = \frac{34}{27} \\
                C_2 = \frac{-7}{27}
            \end{cases} \\
            a_n = \frac{34}{27}+(-2)^n -\frac{7}{27} + (-2)^n \left(\frac{n}{12}-\frac{7}{36}n\right)
        \end{gather*}
    \end{solution}
\end{task}